# Static Generation Fix - Build Error Resolution\n\n## Problem\n\n**Error during `npm run build`:**\n```\nTypeError: Cannot destructure property 'apiKey' of 't' as it is null.\n```\n\n**Root Cause:** \nNext.js tries to pre-render all pages during static generation, including modal pages. During this phase, the Agility SDK `modalProps` is `null`, causing destructuring errors.\n\n## Solution Applied\n\n### 1. Safe Modal Props Destructuring\n\n**Before (causing errors):**\n```typescript\nconst { apiKey, channelId } = modalProps as YouTubeVideoSelectorProps\n```\n\n**After (safe destructuring):**\n```typescript\nconst props = (modalProps as YouTubeVideoSelectorProps) || {}\nconst { apiKey = '', channelId } = props\n```\n\n### 2. Added Static Generation Guards\n\n**Added early returns for missing API keys:**\n```typescript\nif (!apiKey) {\n  return (\n    <div className=\"h-full flex flex-col items-center justify-center\">\n      <div className=\"text-center\">\n        <p className=\"text-gray-600\">Loading YouTube Video Selector...</p>\n      </div>\n    </div>\n  )\n}\n```\n\n### 3. Enhanced SWR Hook Safety\n\n**Before:**\n```typescript\nuseSWR(apiKey ? [url, apiKey] : null, ...)\n```\n\n**After:**\n```typescript\nuseSWR(apiKey && apiKey.length > 0 ? [url, apiKey] : null, ...)\n```\n\n## Files Modified\n\n✅ **Modal Components:**\n- `/app/modals/youtube-video-selector/page.tsx`\n- `/app/modals/youtube-multi-video-selector/page.tsx`\n- `/app/modals/youtube-playlist-selector/page.tsx`\n\n✅ **React Hooks:**\n- `/hooks/useYouTubeVideos.ts`\n- `/hooks/useYouTubePlaylists.ts`\n\n## Why This Fix Works\n\n1. **Graceful Degradation:** Components now handle missing props during static generation\n2. **No API Calls During Build:** SWR hooks won't trigger with empty API keys\n3. **Better UX:** Loading states provide feedback when components initialize\n4. **Type Safety:** Proper fallback values prevent runtime errors\n\n## Verification\n\n**Test the fix:**\n```bash\nnpm run build\n```\n\n**Expected result:** Build completes successfully with static generation of all pages.\n\n## Technical Notes\n\n- Modal components in Agility apps are only fully functional when opened with props\n- During static generation, these components render fallback states\n- This pattern is common for CMS app components that depend on dynamic context\n- The fix maintains full functionality while enabling successful builds\n